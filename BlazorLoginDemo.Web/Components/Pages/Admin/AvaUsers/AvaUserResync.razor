@page "/admin/avausers/resync"
@rendermode InteractiveServer

@inject BlazorLoginDemo.Shared.Services.Interfaces.User.IAvaUserService AvaUserService

<PageTitle>Manual User Resync</PageTitle>

<div class="container py-4">
    <h1 class="display-6 mb-3">Manual User Resync</h1>
    <p>
        This page enables you to initiate a manual ingest of users into <code>AvaUsers</code>.
        It will capture any accounts that have been created but not automatically synchronized.
        Use this function to ensure all user records are fully up to date.
    </p>

    <div class="mb-3">
        <button class="btn btn-primary" @onclick="StartIngest" disabled="@_busy">
            <i class="bi bi-person-down me-1"></i> @(_busy ? "Ingesting…" : "Start Ingest")
        </button>
    </div>

    @if (_busy)
    {
        <div class="alert alert-info">
            Ingest in progress… please wait.
        </div>
    }

    @if (_finished)
    {
        <div class="alert alert-success">
            @_resultsCount results were ingested.
        </div>
    }
</div>

<div class="row row-cols-1 row-cols-md-3 g-3">
    <div class="col">
        <div class="card shadow-sm h-100">
            <div class="card-body text-center">
                <h5 class="card-title">Resync Users</h5>
                <p class="card-text">Syncs all users from the default table.</p>
                <button class="btn btn-primary">Run Sync</button>
            </div>
        </div>
    </div>
    <!-- Copy & paste this block for each new sync type -->
    <div class="col">
        <div class="card shadow-sm h-100">
            <div class="card-body text-center">
                <h5 class="card-title">Resync Clients</h5>
                <p class="card-text">Syncs client data into application tables.</p>
                <button class="btn btn-primary">Run Sync</button>
            </div>
        </div>
    </div>
</div>



<ul class="list-group">
    <li class="list-group-item d-flex justify-content-between align-items-center">
        Resync Users
        <button class="btn btn-sm btn-outline-primary">Run</button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
        Resync Clients
        <button class="btn btn-sm btn-outline-primary">Run</button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
        Resync Accounts
        <button class="btn btn-sm btn-outline-primary">Run</button>
    </li>
</ul>



<div class="d-grid gap-3 d-md-block">
    <button class="btn btn-primary btn-lg">Resync Users</button>
    <button class="btn btn-success btn-lg">Resync Clients</button>
    <button class="btn btn-warning btn-lg">Resync Accounts</button>
    <button class="btn btn-danger btn-lg">Resync Transactions</button>
</div>




<ul class="list-group">
    <li class="list-group-item d-flex justify-content-between align-items-center">
        Resync Users
        <button class="btn btn-sm btn-outline-primary">Run</button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
        Resync Clients
        <button class="btn btn-sm btn-outline-primary">Run</button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
        Resync Accounts
        <button class="btn btn-sm btn-outline-primary">Run</button>
    </li>
</ul>



<div class="d-grid gap-3 d-md-block">
    <button class="btn btn-primary btn-lg">Resync Users</button>
    <button class="btn btn-success btn-lg">Resync Clients</button>
    <button class="btn btn-warning btn-lg">Resync Accounts</button>
    <button class="btn btn-danger btn-lg">Resync Transactions</button>
</div>



<div class="d-grid gap-3 d-md-block">
    <button class="btn btn-primary btn-lg">Resync Users</button>
    <button class="btn btn-success btn-lg">Resync Clients</button>
    <button class="btn btn-warning btn-lg">Resync Accounts</button>
    <button class="btn btn-danger btn-lg">Resync Transactions</button>
</div>



<div class="accordion" id="syncAccordion">
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingUsers">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseUsers">
                Resync Users
            </button>
        </h2>
        <div id="collapseUsers" class="accordion-collapse collapse show" data-bs-parent="#syncAccordion">
            <div class="accordion-body">
                Syncs all users into the application tables.
                <button class="btn btn-primary mt-2">Run Sync</button>
            </div>
        </div>
    </div>

    <!-- Repeat for Clients, Accounts, etc. -->
</div>


@code {
    private bool _busy;
    private bool _finished;
    private int _resultsCount;

    private async Task StartIngest()
    {
        _busy = true;
        _finished = false;
        _resultsCount = 0;

        try
        {
            // TODO: Replace with your ingest function
            await Task.Delay(2000); // simulate work
            _resultsCount = await AvaUserService.IngestUsersAsync();
        }
        finally
        {
            _busy = false;
            _finished = true;
        }
    }
}
