@page "/admin/avausers/resync"
@rendermode InteractiveServer

@inject BlazorLoginDemo.Shared.Services.Interfaces.User.IAvaUserService AvaUserService

<PageTitle>Manual User Resync</PageTitle>

<div class="container py-4">
    <h1>Manual User Resync</h1>
    <p>
        This page enables you to initiate a manual ingest of users into <code>AvaUsers</code>.
        It will capture any accounts that have been created but not automatically synchronized.
        Use this function to ensure all user records are fully up to date.
    </p>

    <div class="mb-3">
        <button class="btn btn-primary" @onclick="StartIngest" disabled="@_busy">
            <i class="bi bi-person-down me-1"></i> @(_busy ? "Ingesting…" : "Start Ingest")
        </button>
    </div>

    @if (_busy)
    {
        <div class="alert alert-info">
            Ingest in progress… please wait.
        </div>
    }

    @if (_finished)
    {
        <div class="alert alert-success">
            @_resultsCount results were ingested.
        </div>
    }
</div>

@code {
    private bool _busy;
    private bool _finished;
    private int _resultsCount;

    private async Task StartIngest()
    {
        _busy = true;
        _finished = false;
        _resultsCount = 0;

        try
        {
            // TODO: Replace with your ingest function
            await Task.Delay(2000); // simulate work
            _resultsCount = await AvaUserService.IngestUsersAsync();
        }
        finally
        {
            _busy = false;
            _finished = true;
        }
    }
}
